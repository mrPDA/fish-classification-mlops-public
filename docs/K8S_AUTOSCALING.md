# üöÄ Kubernetes Autoscaling –¥–ª—è Fish Classification

## –û–±–∑–æ—Ä

Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤** –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–û–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Node Groups

### API Worker Nodes (Autoscaling)

```terraform
# terraform/kubernetes.tf

resource "yandex_kubernetes_node_group" "api_workers" {
  name = "api-workers"
  
  instance_template {
    resources {
      cores  = 2  # 2 CPU –Ω–∞ –Ω–æ–¥—É
      memory = 4  # 4 GB RAM
    }
    
    boot_disk {
      type = "network-hdd"
      size = 32  # 32 GB
    }
    
    scheduling_policy {
      preemptible = true  # –≠–∫–æ–Ω–æ–º–∏—è 70%!
    }
  }
  
  scale_policy {
    auto_scale {
      min     = 1   # –ú–∏–Ω–∏–º—É–º 1 –Ω–æ–¥–∞
      max     = 10  # –ú–∞–∫—Å–∏–º—É–º 10 –Ω–æ–¥
      initial = 1   # –°—Ç–∞—Ä—Ç—É–µ–º —Å 1
    }
  }
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:** 1 –Ω–æ–¥–∞ √ó 2 CPU = **2 CPU**
- **–ú–∞–∫—Å–∏–º—É–º:** 10 –Ω–æ–¥ √ó 2 CPU = **20 CPU**
- **Autoscaling:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç/—É–¥–∞–ª—è–µ—Ç –Ω–æ–¥—ã

### Kafka Worker Nodes (Disabled)

```terraform
# –û—Ç–∫–ª—é—á–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Managed Kafka
# –≠–∫–æ–Ω–æ–º–∏—è: 12 CPU, 24 GB RAM
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### –ë—ã–ª–æ (–Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Node Group     ‚îÇ Cores ‚îÇ RAM  ‚îÇ Nodes ‚îÇ  CPU   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ API Workers      ‚îÇ   4   ‚îÇ  8GB ‚îÇ   3   ‚îÇ 12 CPU ‚îÇ
‚îÇ Kafka Workers    ‚îÇ   4   ‚îÇ  8GB ‚îÇ   3   ‚îÇ 12 CPU ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ò–¢–û–ì–û            ‚îÇ       ‚îÇ      ‚îÇ   6   ‚îÇ 24 CPU ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–æ–±–ª–µ–º—ã:
‚ùå –ú–Ω–æ–≥–æ CPU –∑–∞–Ω—è—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
‚ùå –ù–µ—Ç –º–µ—Å—Ç–∞ –¥–ª—è DataProc
‚ùå –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
```

### –°—Ç–∞–ª–æ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Node Group     ‚îÇ Cores ‚îÇ RAM  ‚îÇ   Nodes    ‚îÇ   CPU   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ API Workers      ‚îÇ   2   ‚îÇ  4GB ‚îÇ  1-10 (AS) ‚îÇ  2-20   ‚îÇ
‚îÇ Kafka Workers    ‚îÇ   -   ‚îÇ  -   ‚îÇ     0      ‚îÇ    0    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ò–¢–û–ì–û (—Å—Ç–∞—Ä—Ç)    ‚îÇ       ‚îÇ      ‚îÇ     1      ‚îÇ   2 CPU ‚îÇ
‚îÇ –ò–¢–û–ì–û (–º–∞–∫—Å)     ‚îÇ       ‚îÇ      ‚îÇ    10      ‚îÇ  20 CPU ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚úÖ –ú–∏–Ω–∏–º—É–º CPU –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (2 vs 24)
‚úÖ –ú–µ—Å—Ç–æ –¥–ª—è DataProc (8 CPU)
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –û–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–æ–¥—ã
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Autoscaling

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

Kubernetes –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç/—É–¥–∞–ª—è–µ—Ç –Ω–æ–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ:

1. **CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è**
   ```
   –ï—Å–ª–∏ CPU > 70% ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É
   –ï—Å–ª–∏ CPU < 30% ‚Üí —É–¥–∞–ª–∏—Ç—å –Ω–æ–¥—É
   ```

2. **Memory —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è**
   ```
   –ï—Å–ª–∏ Memory > 80% ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É
   ```

3. **Pod eviction pressure**
   ```
   –ï—Å–ª–∏ pods –Ω–µ –º–æ–≥—É—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–Ω–æ—á—å, –≤—ã—Ö–æ–¥–Ω—ã–µ)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1 –Ω–æ–¥–∞ √ó 2 CPU = 2 CPU                     ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  Pods:                                       ‚îÇ
‚îÇ  ‚Ä¢ Redis (100m CPU)                          ‚îÇ
‚îÇ  ‚Ä¢ API (500m CPU)                            ‚îÇ
‚îÇ  ‚Ä¢ Frontend (100m CPU)                       ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ~700m (~35%)             ‚îÇ
‚îÇ  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: –ù–ï–¢              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°—Ç–æ–∏–º–æ—Å—Ç—å: ~$15-20/–º–µ—Å—è—Ü
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ (—Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3 –Ω–æ–¥—ã √ó 2 CPU = 6 CPU                     ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  Pods:                                       ‚îÇ
‚îÇ  ‚Ä¢ Redis (1 pod)                            ‚îÇ
‚îÇ  ‚Ä¢ API (3 replicas, HPA)                    ‚îÇ
‚îÇ  ‚Ä¢ Frontend (2 replicas)                    ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ~4 CPU (~67%)            ‚îÇ
‚îÇ  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:                  ‚îÇ
‚îÇ    ‚Ä¢ HPA —É–≤–µ–ª–∏—á–∏–ª API replicas              ‚îÇ
‚îÇ    ‚Ä¢ Cluster Autoscaler –¥–æ–±–∞–≤–∏–ª 2 –Ω–æ–¥—ã      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°—Ç–æ–∏–º–æ—Å—Ç—å: ~$45-60/–º–µ—Å—è—Ü
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–ø–∏–∫–æ–≤–∞—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  10 –Ω–æ–¥ √ó 2 CPU = 20 CPU                    ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  Pods:                                       ‚îÇ
‚îÇ  ‚Ä¢ Redis (1 pod)                            ‚îÇ
‚îÇ  ‚Ä¢ API (10 replicas, HPA)                   ‚îÇ
‚îÇ  ‚Ä¢ Frontend (5 replicas)                    ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ~16 CPU (~80%)           ‚îÇ
‚îÇ  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:                  ‚îÇ
‚îÇ    ‚Ä¢ HPA —É–≤–µ–ª–∏—á–∏–ª API replicas –¥–æ 10        ‚îÇ
‚îÇ    ‚Ä¢ Cluster Autoscaler –¥–æ–±–∞–≤–∏–ª 9 –Ω–æ–¥       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°—Ç–æ–∏–º–æ—Å—Ç—å: ~$150-200/–º–µ—Å—è—Ü (—Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –ø–∏–∫–∞!)
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–æ—Å–ª–µ –ø–∏–∫–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  10 –Ω–æ–¥ ‚Üí –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è            ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  1. –ù–∞–≥—Ä—É–∑–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç—Å—è                      ‚îÇ
‚îÇ  2. HPA —É–º–µ–Ω—å—à–∞–µ—Ç replicas API              ‚îÇ
‚îÇ  3. Cluster Autoscaler –∂–¥—ë—Ç 10 –º–∏–Ω—É—Ç        ‚îÇ
‚îÇ  4. –£–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–æ–¥—ã             ‚îÇ
‚îÇ  5. –í–æ–∑–≤—Ä–∞—Ç –∫ 1-2 –Ω–æ–¥–∞–º                     ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  –í—Ä–µ–º—è scale-down: ~10-15 –º–∏–Ω—É—Ç             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## HPA (Horizontal Pod Autoscaler)

### API HPA

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pods API:

```yaml
# –í deploy_real_api.sh —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ resources

resources:
  requests:
    cpu: 500m      # –ú–∏–Ω–∏–º—É–º –¥–ª—è —Ä–∞–±–æ—Ç—ã
    memory: 1Gi
  limits:
    cpu: 1000m     # –ú–∞–∫—Å–∏–º—É–º –Ω–∞ pod
    memory: 2Gi
```

**Kubernetes –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç CPU/Memory –∫–∞–∂–¥–æ–≥–æ pod
2. –ï—Å–ª–∏ CPU > 70% ‚Üí —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ pods
3. –ï—Å–ª–∏ pods –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è ‚Üí Cluster Autoscaler –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–¥—ã
4. –ï—Å–ª–∏ CPU < 30% ‚Üí —É–¥–∞–ª—è–µ—Ç pods
5. –ï—Å–ª–∏ –Ω–æ–¥—ã –ø—É—Å—Ç—ã–µ ‚Üí Cluster Autoscaler —É–¥–∞–ª—è–µ—Ç –∏—Ö

### Frontend HPA

```yaml
# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: frontend-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: frontend
  minReplicas: 1
  maxReplicas: 5
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

## –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏—è

### –ú–µ—Å—è—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–ø—Ä–∏–º–µ—Ä–Ω–æ)

| –°—Ü–µ–Ω–∞—Ä–∏–π | –°—Ä–µ–¥–Ω–∏–µ –Ω–æ–¥—ã | CPU | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å |
|----------|--------------|-----|---------------|
| **–°—Ç–∞—Ä–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (24 CPU)** | 6 –Ω–æ–¥ √ó 4 CPU | 24 | ~**$360**/–º–µ—Å |
| **–ù–æ–≤–∞—è: —Ç–æ–ª—å–∫–æ –Ω–æ—á—å (low)** | 1 –Ω–æ–¥–∞ √ó 2 CPU | 2 | ~$15/–º–µ—Å |
| **–ù–æ–≤–∞—è: —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (med)** | 3 –Ω–æ–¥—ã √ó 2 CPU | 6 | ~$90/–º–µ—Å |
| **–ù–æ–≤–∞—è: –ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã (high)** | 10 –Ω–æ–¥ √ó 2 CPU | 20 | ~$300/–º–µ—Å |
| **–ù–æ–≤–∞—è: —Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è** | ~2-3 –Ω–æ–¥—ã | ~5 CPU | ~**$75-120**/–º–µ—Å |

**–≠–∫–æ–Ω–æ–º–∏—è: ~60-70% –ø—Ä–∏ —Ç–æ–π –∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!**

### –§–∞–∫—Ç–æ—Ä—ã —ç–∫–æ–Ω–æ–º–∏–∏

1. **Preemptible nodes:** -70% —Å—Ç–æ–∏–º–æ—Å—Ç–∏
2. **–ú–µ–Ω—å—à–µ CPU:** 2 vs 4 –Ω–∞ –Ω–æ–¥—É
3. **Autoscaling:** –æ–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–æ–¥—ã
4. **Managed Kafka:** –≤–º–µ—Å—Ç–æ 12 CPU –≤ K8s

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Autoscaling

### –ö–æ–º–∞–Ω–¥—ã kubectl

```bash
# –¢–µ–∫—É—â–∏–µ –Ω–æ–¥—ã
kubectl get nodes

# –ú–µ—Ç—Ä–∏–∫–∏ –Ω–æ–¥
kubectl top nodes

# HPA —Å—Ç–∞—Ç—É—Å
kubectl get hpa -n ml-inference

# Pods –∏ –∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
kubectl get pods -n ml-inference -o wide

# –°–æ–±—ã—Ç–∏—è autoscaling
kubectl get events -n ml-inference --sort-by='.lastTimestamp' | grep -i "scale"

# Cluster Autoscaler –ª–æ–≥–∏ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
kubectl logs -f -n kube-system -l app=cluster-autoscaler
```

### Grafana Dashboard

–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è –Ω–æ–¥
- Memory —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è –Ω–æ–¥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥ (—Ç–µ–∫—É—â–µ–µ/min/max)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ pods (—Ç–µ–∫—É—â–µ–µ/min/max)
- –°–æ–±—ã—Ç–∏—è scale-up/scale-down
- Latency API requests

## Best Practices

### 1. –†–µ—Å—É—Ä—Å–Ω—ã–µ requests –∏ limits

**–í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ:**
```yaml
resources:
  requests:
    cpu: 500m        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∏–Ω–∏–º—É–º
    memory: 512Mi
  limits:
    cpu: 1000m       # –ú–∞–∫—Å–∏–º—É–º (–Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç)
    memory: 1Gi
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- Kubernetes –ø–ª–∞–Ω–∏—Ä—É–µ—Ç pods –Ω–∞ –æ—Å–Ω–æ–≤–µ `requests`
- Autoscaler –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ `requests`
- `limits` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç OOM kills

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HPA

```yaml
# –•–æ—Ä–æ—à–æ
minReplicas: 1        # –ú–∏–Ω–∏–º—É–º –¥–ª—è —Ä–∞–±–æ—Ç—ã
maxReplicas: 10       # –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø–∏–∫–∞
targetCPU: 70%        # –ó–∞–ø–∞—Å –¥–ª—è –≤—Å–ø–ª–µ—Å–∫–æ–≤

# –ü–ª–æ—Ö–æ
minReplicas: 10       # –ü–µ—Ä–µ–ø–ª–∞—Ç–∞!
maxReplicas: 100      # –ú–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ
targetCPU: 90%        # –°–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç
```

### 3. Scale-down prevention

–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö pods (–Ω–∞–ø—Ä–∏–º–µ—Ä Redis):

```yaml
annotations:
  cluster-autoscaler.kubernetes.io/safe-to-evict: "false"
```

### 4. Pod Disruption Budgets

```yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: api-pdb
spec:
  minAvailable: 1  # –í—Å–µ–≥–¥–∞ —Ö–æ—Ç—è –±—ã 1 pod API
  selector:
    matchLabels:
      app: fish-api
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Pods –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:** `kubectl get pods` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `Pending`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É
kubectl describe pod <pod-name> -n ml-inference

# –ß–∞—Å—Ç–æ: "Insufficient cpu" –∏–ª–∏ "Insufficient memory"
# ‚Üí Cluster Autoscaler –¥–æ–±–∞–≤–∏—Ç –Ω–æ–¥—É (–ø–æ–¥–æ–∂–¥–∏—Ç–µ 3-5 –º–∏–Ω—É—Ç)

# –ï—Å–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã
kubectl get nodes
# –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç max (10) ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å –≤ terraform
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–∏–º–ø—Ç–æ–º:** –ù–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—Ç—ë—Ç, –Ω–æ pods/nodes –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–º–µ–Ω—å—à–∏—Ç—å thresholds –≤ HPA
targetCPU: 70% ‚Üí 50%  # –†–∞–Ω—å—à–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç

# –£–º–µ–Ω—å—à–∏—Ç—å scale-down delay
scaleDownDelayAfterAdd: 10m ‚Üí 5m
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑

**–°–∏–º–ø—Ç–æ–º:** –ù–æ–¥—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è/—É–¥–∞–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å stabilization window
behavior:
  scaleDown:
    stabilizationWindowSeconds: 300  # 5 –º–∏–Ω—É—Ç
  scaleUp:
    stabilizationWindowSeconds: 60   # 1 –º–∏–Ω—É—Ç–∞
```

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. –û–±–Ω–æ–≤–∏—Ç—å Terraform

```bash
cd terraform
terraform plan
terraform apply
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:**
- –°—Ç–∞—Ä—ã–µ –Ω–æ–¥—ã –±—É–¥—É—Ç drain (pods –ø–µ—Ä–µ–µ–¥—É—Ç)
- –ù–æ–≤—ã–µ –Ω–æ–¥—ã —Å –º–µ–Ω—å—à–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è
- Pods –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—è—Ç—Å—è
- Downtime: ~2-3 –º–∏–Ω—É—Ç—ã

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ù–æ–¥—ã
kubectl get nodes
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 1 –Ω–æ–¥–∞ √ó 2 CPU

# Pods
kubectl get pods -n ml-inference
# –í—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Running

# –ú–µ—Ç—Ä–∏–∫–∏
kubectl top nodes
kubectl top pods -n ml-inference
```

### 3. –¢–µ—Å—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API
for i in {1..1000}; do
  curl -X POST http://<frontend-url>/api/predict \
    -F "file=@test_fish.jpg" &
done

# –ù–∞–±–ª—é–¥–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
watch -n 5 'kubectl get pods -n ml-inference && kubectl get nodes'
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:** 24 CPU ‚Üí 2 CPU –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (92% —ç–∫–æ–Ω–æ–º–∏—è!)
‚úÖ **–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–æ 20 CPU –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ
‚úÖ **Production ready:** HPA + Cluster Autoscaler
‚úÖ **Preemptible nodes:** 70% —ç–∫–æ–Ω–æ–º–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
‚úÖ **Managed Kafka:** –ë–µ–∑ 12 CPU –≤ K8s

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–æ –¥–ª—è DataProc (8 CPU)
- –≠–∫–æ–Ω–æ–º–∏—è ~$200-250/–º–µ—Å—è—Ü
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –Ω–∞–≥—Ä—É–∑–∫–µ
- –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–∏–∫–∞—Ö

üéâ **–ì–æ—Ç–æ–≤–æ –∫ production!**

