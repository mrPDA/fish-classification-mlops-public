# ๐ ะขะตะบััะธะน ััะฐััั ะฟัะพะตะบัะฐ

**ะะฐัะฐ**: 5 ะพะบััะฑัั 2025  
**ะญัะฐะฟ**: ะะฑััะตะฝะธะต ะผะพะดะตะปะธ ะธ ะฟะพะดะณะพัะพะฒะบะฐ ะบ Inference

---

## โ ะงัะพ ัะถะต ะณะพัะพะฒะพ

### 1. ะะฝััะฐััััะบัััะฐ (100%)
- โ Yandex Cloud ะฝะฐัััะพะตะฝ
- โ Terraform ะบะพะฝัะธะณััะฐัะธั
- โ PostgreSQL (Managed)
- โ Kafka (Managed)
- โ Kubernetes ะบะปะฐััะตั
- โ Managed Airflow
- โ MLflow ัะตัะฒะตั (VM)
- โ Prometheus ะผะพะฝะธัะพัะธะฝะณ (VM)
- โ S3 bucket ะดะปั ะดะฐะฝะฝัั
- โ Lockbox ะดะปั ัะตะบัะตัะพะฒ
- โ NAT Gateway ะดะปั DataProc
- โ Security Groups ะฝะฐัััะพะตะฝั
- โ IAM ัะพะปะธ ะดะปั DataProc

### 2. DataProc ะธะฝัะตะณัะฐัะธั (100%)
- โ ะะฐะนะดะตะฝ ะฟัะฐะฒะธะปัะฝัะน ะพะฟะตัะฐัะพั (`DataprocCreateClusterOperator`)
- โ ะัะต IAM ัะพะปะธ ะดะพะฑะฐะฒะปะตะฝั
- โ Security Group ะฟัะฐะฒะธะปะฐ ะฝะฐัััะพะตะฝั
- โ SSH ะบะปััะธ ะฒ Lockbox
- โ ะขะตััะพะฒัะน DAG ััะฟะตัะฝะพ ัะพะทะดะฐะป ะธ ัะดะฐะปะธะป ะบะปะฐััะตั

### 3. ML Pipeline (90%)
- โ PySpark ัะบัะธะฟั ะดะปั ะพะฑััะตะฝะธั ั Transfer Learning (MobileNetV2)
- โ ะะฝัะตะณัะฐัะธั ั MLflow
- โ DAG ะดะปั ะฟะพะปะฝะพะณะพ ะพะฑััะตะฝะธั (`fish_classification_training_full`)
- โ ะขะตััะพะฒัะน DAG ะดะปั ะฟัะพะฒะตัะบะธ MLflow (`test_mlflow_integration`)
- โ ะะฐัะฐัะตั ะทะฐะณััะถะตะฝ ะฒ S3
- ๐ ะะถะธะดะฐะตั ะทะฐะฟััะบะฐ ะพะฑััะตะฝะธั

### 4. ะะพะบัะผะตะฝัะฐัะธั (100%)
- โ Transfer Learning guide
- โ MLflow test instructions
- โ Inference deployment plan
- โ Troubleshooting guides

---

## ๐ ะขะตะบััะธะน ััะฐะฟ: ะะฑััะตะฝะธะต ะผะพะดะตะปะธ

### ะจะฐะณ 1: ะขะตัั MLflow (2-3 ะผะธะฝััั)

**DAG**: `test_mlflow_integration`

**ะงัะพ ะดะตะปะฐะตั**:
1. ะัะพะฒะตััะตั ะฟะพะดะบะปััะตะฝะธะต ะบ MLflow
2. ะะฑััะฐะตั ะฟัะพัััั Random Forest ะผะพะดะตะปั
3. ะะพะณะธััะตั ะฟะฐัะฐะผะตััั, ะผะตััะธะบะธ, ะฐััะตัะฐะบัั
4. ะกะพััะฐะฝัะตั ะผะพะดะตะปั ะฒ Model Registry
5. ะะฐะณััะถะฐะตั ะผะพะดะตะปั ะพะฑัะฐัะฝะพ

**ะะฐะบ ะทะฐะฟัััะธัั**:
1. ะัะบัะพะนัะต Airflow UI
2. ะะฐะนะดะธัะต DAG `test_mlflow_integration`
3. ะะฐะถะผะธัะต "Trigger DAG"
4. ะะถะธะดะฐะนัะต ~2-3 ะผะธะฝััั

**ะัะพะฒะตัะบะฐ ัะตะทัะปััะฐัะฐ**:
- ะัะบัะพะนัะต MLflow UI: http://130.193.38.189:5000
- ะญะบัะฟะตัะธะผะตะฝั: `test-mlflow-integration`
- ะะพะดะตะปั: `test-random-forest` ะฒ Model Registry

### ะจะฐะณ 2: ะะฑััะตะฝะธะต ัะตะฐะปัะฝะพะน ะผะพะดะตะปะธ (20-25 ะผะธะฝัั)

**DAG**: `fish_classification_training_full`

**ะงัะพ ะดะตะปะฐะตั**:
1. ะกะพะทะดะฐัั DataProc ะบะปะฐััะตั (5-7 ะผะธะฝ)
2. ะะฐะณััะถะฐะตั ะดะฐัะฐัะตั ะธะท S3
3. ะะฑััะฐะตั MobileNetV2 ั Transfer Learning (10-15 ะผะธะฝ)
4. ะะพะณะธััะตั ะฒัั ะฒ MLflow
5. ะฃะดะฐะปัะตั DataProc ะบะปะฐััะตั (2-3 ะผะธะฝ)

**ะะฐะบ ะทะฐะฟัััะธัั**:
1. ะัะบัะพะนัะต Airflow UI
2. ะะฐะนะดะธัะต DAG `fish_classification_training_full`
3. ะะฐะถะผะธัะต "Trigger DAG"
4. ะะถะธะดะฐะนัะต ~20-25 ะผะธะฝัั

**ะัะพะฒะตัะบะฐ ัะตะทัะปััะฐัะฐ**:
- ะัะบัะพะนัะต MLflow UI: http://130.193.38.189:5000
- ะญะบัะฟะตัะธะผะตะฝั: `fish-classification`
- ะะพะดะตะปั: `fish-classification-mobilenetv2` ะฒ Model Registry
- ะะถะธะดะฐะตะผะฐั ัะพัะฝะพััั: 75-85% (validation)

---

## ๐ฏ ะกะปะตะดัััะธะน ััะฐะฟ: Inference API

### ะะพัะปะต ััะฟะตัะฝะพะณะพ ะพะฑััะตะฝะธั ะผะพะดะตะปะธ

**ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั**:

1. **ะกะพะทะดะฐัั FastAPI ัะตัะฒะธั** (`api/inference_service.py`)
   - ะะฐะณััะทะบะฐ ะผะพะดะตะปะธ ะธะท MLflow
   - Endpoint `/predict` ะดะปั ะบะปะฐััะธัะธะบะฐัะธะธ
   - Preprocessing ะธะทะพะฑัะฐะถะตะฝะธะน
   - ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะตะดัะบะฐะทะฐะฝะธะน

2. **ะกะพะฑัะฐัั Docker ะพะฑัะฐะท**
   ```bash
   docker build -t fish-inference-api:latest api/
   docker push cr.yandex/.../fish-inference-api:latest
   ```

3. **ะะฐะทะฒะตัะฝััั ะฒ Kubernetes**
   ```bash
   kubectl apply -f k8s/inference-api-deployment.yaml
   kubectl apply -f k8s/inference-api-service.yaml
   ```

4. **ะกะพะทะดะฐัั Web UI** (`web/index.html`)
   - Drag & drop ะดะปั ะทะฐะณััะทะบะธ ัะพัะพ
   - ะัะพะฑัะฐะถะตะฝะธะต ัะตะทัะปััะฐัะพะฒ
   - ะะธะทัะฐะปะธะทะฐัะธั ะฒะตัะพััะฝะพััะตะน

5. **ะะฐะทะฒะตัะฝััั Web UI**
   ```bash
   kubectl apply -f k8s/web-ui-deployment.yaml
   kubectl apply -f k8s/web-ui-service.yaml
   ```

**ะะตะทัะปััะฐั**:
- API: `http://<api-ip>/predict`
- Web UI: `http://<web-ui-ip>`
- ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะทะฐะณััะทะธัั ัะพัะพ ััะฑั ะธ ะฟะพะปััะธัั ะบะปะฐััะธัะธะบะฐัะธั

---

## ๐ Checklist ะฝะฐ ัะตะณะพะดะฝั

- [ ] ะะฐะฟัััะธัั `test_mlflow_integration` DAG
- [ ] ะัะพะฒะตัะธัั ัะตะทัะปััะฐัั ะฒ MLflow UI
- [ ] ะะฐะฟัััะธัั `fish_classification_training_full` DAG
- [ ] ะะพะถะดะฐัััั ะทะฐะฒะตััะตะฝะธั ะพะฑััะตะฝะธั (~20-25 ะผะธะฝ)
- [ ] ะัะพะฒะตัะธัั ะพะฑััะตะฝะฝัั ะผะพะดะตะปั ะฒ MLflow UI
- [ ] ะฃะฑะตะดะธัััั, ััะพ ะผะพะดะตะปั ะทะฐัะตะณะธัััะธัะพะฒะฐะฝะฐ ะฒ Model Registry

---

## ๐ Checklist ะฝะฐ ะทะฐะฒััะฐ

- [ ] ะกะพะทะดะฐัั FastAPI Inference Service
- [ ] ะกะพะทะดะฐัั Dockerfile ะดะปั API
- [ ] ะกะพะฑัะฐัั ะธ ะทะฐะณััะทะธัั Docker ะพะฑัะฐะท
- [ ] ะกะพะทะดะฐัั Kubernetes ะผะฐะฝะธัะตััั ะดะปั API
- [ ] ะะฐะทะฒะตัะฝััั API ะฒ Kubernetes
- [ ] ะกะพะทะดะฐัั Web UI (HTML/CSS/JS)
- [ ] ะะฐะทะฒะตัะฝััั Web UI ะฒ Kubernetes
- [ ] ะัะพัะตััะธัะพะฒะฐัั ะฟะพะปะฝัะน workflow
- [ ] ะกะพะทะดะฐัั ะดะตะผะพ-ะฒะธะดะตะพ ัะฐะฑะพัั ัะตัะฒะธัะฐ

---

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- **Airflow UI**: (ะฟะพะปััะธัั ัะตัะตะท `yc airflow cluster get <cluster-id>`)
- **MLflow UI**: http://130.193.38.189:5000
- **Prometheus UI**: http://89.169.137.15:9090
- **Terraform state**: `/Users/denispukinov/Documents/OTUS/Finalwork_2/terraform`
- **DAGs**: `/Users/denispukinov/Documents/OTUS/Finalwork_2/dags`
- **Documentation**: `/Users/denispukinov/Documents/OTUS/Finalwork_2/docs`

---

## ๐ ะััะธัะตะบัััะฐ (ัะธะฝะฐะปัะฝะฐั)

```
โโโโโโโโโโโโโโโ
โ   User      โ
โ  (Browser)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ   Web UI    โ โ Kubernetes LoadBalancer
โ  (Nginx)    โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Inference API      โ โ Kubernetes Deployment (2-10 replicas)
โ  (FastAPI)          โ
โโโโฌโโโโโโโโโโโโฌโโโโโโโ
   โ           โ
   โ           โผ
   โ      โโโโโโโโโโโโโโโ
   โ      โ  PostgreSQL โ โ Predictions Log
   โ      โโโโโโโโโโโโโโโ
   โ
   โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ  MLflow Server       โ โ Model Registry
โ  (VM)                โ
โโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ก ะขะตะบััะธะน ััะฐััั ะธะฝััะฐััััะบัััั

**ะะฐะฟััะตะฝะพ**:
- PostgreSQL: `c9qp41bmeb44uihvu34m`
- Kafka: `c9qimc9iuv6qrekps9kg`
- Kubernetes: `catmbjcaoro1qcv3i8lr`
- Airflow: `c9q4oobb69os0cf1jda8`
- MLflow VM: `fhmkcnavoklpbio9ai15` (130.193.38.189)
- Prometheus VM: `fhmsdl6c1st48e2jtdg7` (89.169.137.15)

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะธัะบะพะฒ**:
- PostgreSQL: 50 GB SSD
- Kafka: 42 GB HDD
- MLflow: 50 GB HDD
- Prometheus: 20 GB HDD
- Kubernetes: 64 GB HDD
- **ะัะพะณะพ SSD**: 50 GB (ะบะฒะพัะฐ ะพัะฒะพะฑะพะถะดะตะฝะฐ ะดะปั DataProc!)

---

**ะกัะฐััั**: โ ะะพัะพะฒะพ ะบ ะพะฑััะตะฝะธั ะผะพะดะตะปะธ!  
**ะกะปะตะดัััะธะน ัะฐะณ**: ะะฐะฟัััะธัั `test_mlflow_integration` DAG
