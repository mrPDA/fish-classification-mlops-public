# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å MLflow

## üìã –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (–±–µ–∑ DataProc)

–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å MLflow **–±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è DataProc –∫–ª–∞—Å—Ç–µ—Ä–∞**, —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ–≥–æ **~2-3 –º–∏–Ω—É—Ç—ã** –≤–º–µ—Å—Ç–æ 20-25 –º–∏–Ω—É—Ç.

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

1. ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MLflow** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLflow —Å–µ—Ä–≤–µ—Ä–∞
2. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏
3. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ accuracy, f1_score –∏ —Ç.–¥.
4. ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –≤ MLflow Model Registry
5. ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (feature importance –∏ —Ç.–¥.)
6. ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º–æ–¥–µ–ª—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Airflow UI

```
http://<airflow-url>:8080
```

### 2. –ù–∞–π–¥–∏—Ç–µ DAG `test_mlflow_integration`

–û–Ω –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ ~1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ S3.

### 3. –ù–∞–∂–º–∏—Ç–µ "Trigger DAG"

### 4. –û–∂–∏–¥–∞–π—Ç–µ ~2-3 –º–∏–Ω—É—Ç—ã

–ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:
1. `test_mlflow_connection` (~10 —Å–µ–∫)
2. `test_mlflow_logging` (~60 —Å–µ–∫) - –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π Random Forest –º–æ–¥–µ–ª–∏
3. `test_mlflow_model_retrieval` (~10 —Å–µ–∫)
4. `print_summary` (~5 —Å–µ–∫)

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ MLflow

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ MLflow UI

```
http://130.193.38.189:5000
```

### 2. –ù–∞–π–¥–∏—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç `test-mlflow-integration`

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∏–¥–∏—Ç–µ:

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `n_estimators`: 100
- `max_depth`: 10
- `min_samples_split`: 2
- `random_state`: 42
- `test_type`: integration_test

**–ú–µ—Ç—Ä–∏–∫–∏:**
- `accuracy`: ~0.85-0.95
- `f1_score`: ~0.85-0.95
- `train_samples`: 800
- `test_samples`: 200

**–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:**
- `model/` - —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è Random Forest –º–æ–¥–µ–ª—å
- `model_info/` - JSON —Å feature importance

**–ú–æ–¥–µ–ª—å –≤ Registry:**
- –ò–º—è: `test-random-forest`
- –í–µ—Ä—Å–∏—è: 1 (–∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–¢–µ—Å—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º, –µ—Å–ª–∏:

1. ‚úÖ –í—Å–µ 4 –∑–∞–¥–∞—á–∏ –≤ DAG –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `success`
2. ‚úÖ –í MLflow UI –≤–∏–¥–µ–Ω –Ω–æ–≤—ã–π run –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ `test-mlflow-integration`
3. ‚úÖ –í run'–µ –µ—Å—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
4. ‚úÖ –ú–æ–¥–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ Model Registry

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused" –∫ MLflow

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ MLflow VM –∑–∞–ø—É—â–µ–Ω–∞
ssh ubuntu@130.193.38.189
sudo systemctl status mlflow

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl start mlflow
```

### –ü—Ä–æ–±–ª–µ–º–∞: "ModuleNotFoundError: No module named 'sklearn'"

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! Airflow worker –Ω–µ –∏–º–µ–µ—Ç sklearn. –¢–µ—Å—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–π–¥—ë—Ç, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Airflow.

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞, –¥–æ–±–∞–≤—å—Ç–µ `scikit-learn` –≤ `pip_packages` –≤ `airflow.tf` –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ Airflow –∫–ª–∞—Å—Ç–µ—Ä.

### –ü—Ä–æ–±–ª–µ–º–∞: "No run_id found"

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ `test_mlflow_logging` —É–ø–∞–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –≤ Airflow UI.

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª–Ω—ã–π pipeline –æ–±—É—á–µ–Ω–∏—è:

```
DAG: fish_classification_training_full
–í—Ä–µ–º—è: ~20-25 –º–∏–Ω—É—Ç
```

–≠—Ç–æ—Ç DAG:
1. –°–æ–∑–¥–∞—Å—Ç DataProc –∫–ª–∞—Å—Ç–µ—Ä
2. –û–±—É—á–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä—ã–± —Å Transfer Learning
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ MLflow
4. –£–¥–∞–ª–∏—Ç DataProc –∫–ª–∞—Å—Ç–µ—Ä

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –¢–µ—Å—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å - —ç—Ç–æ –ø—Ä–æ—Å—Ç–∞—è Random Forest –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä—ã–± –±—É–¥–µ—Ç CNN (MobileNetV2) —Å Transfer Learning
- –¢–µ—Å—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç–∞ - –¥–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É
- –¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ production –¥–∞–Ω–Ω—ã–µ
